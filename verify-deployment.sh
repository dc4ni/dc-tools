#!/usr/bin/expect -f

set timeout 30

puts "\n========================================="
puts "ğŸ‰ DirectConverter éƒ¨ç½²æˆåŠŸ!"
puts "=========================================\n"

spawn ssh root@172.238.14.142
expect "password:"
send "@Joendle396\r"
expect "root@*"

send "cd /opt/directconverter\r"
expect "root@*"

send "echo '=== å®¹å™¨ç‹€æ…‹ ==='\r"
expect "root@*"
send "docker-compose ps\r"
expect "root@*"

send "echo '\n=== æ¸¬è©¦ä¸»é  ==='\r"
expect "root@*"
send "curl -I http://172.238.14.142 2>&1 | head -8\r"
expect "root@*"

send "echo '\n=== æ¸¬è©¦ API ==='\r"
expect "root@*"
send "curl http://172.238.14.142/api/formats 2>&1 | python3 -m json.tool 2>/dev/null | head -20 || curl http://172.238.14.142/api/formats 2>&1 | head -10\r"
expect "root@*"

send "echo '\n=== ç£ç¢Ÿä½¿ç”¨ ==='\r"
expect "root@*"
send "df -h | grep -E '(Filesystem|/$)'\r"
expect "root@*"

send "echo '\n=== è¨˜æ†¶é«”ä½¿ç”¨ ==='\r"
expect "root@*"
send "free -h\r"
expect "root@*"

send "exit\r"
expect eof

puts "\n========================================="
puts "âœ… éƒ¨ç½²é©—è­‰å®Œæˆ!"
puts "=========================================\n"
puts "ğŸ“‹ éƒ¨ç½²è³‡è¨Š:"
puts "  â€¢ ä¸»æ©Ÿ: Linode Ubuntu 24.04.3 LTS"
puts "  â€¢ IP: 172.238.14.142"
puts "  â€¢ è¨ªå•ç¶²å€: http://172.238.14.142"
puts "  â€¢ API æ–‡æª”: http://172.238.14.142/api/docs"
puts ""
puts "ğŸ³ å®¹å™¨è³‡è¨Š:"
puts "  â€¢ å¾Œç«¯: FastAPI + Uvicorn (Port 8000)"
puts "  â€¢ å‰ç«¯: Vite + React (Port 3000)"
puts "  â€¢ åå‘ä»£ç†: Nginx (Port 80)"
puts ""
puts "ğŸ“ ç®¡ç†æŒ‡ä»¤:"
puts "  æŸ¥çœ‹æ—¥èªŒ:"
puts "    ssh root@172.238.14.142 'cd /opt/directconverter && docker-compose logs -f'"
puts ""
puts "  é‡å•Ÿæœå‹™:"
puts "    ssh root@172.238.14.142 'cd /opt/directconverter && docker-compose restart'"
puts ""
puts "  åœæ­¢æœå‹™:"
puts "    ssh root@172.238.14.142 'cd /opt/directconverter && docker-compose down'"
puts ""
puts "  å•Ÿå‹•æœå‹™:"
puts "    ssh root@172.238.14.142 'cd /opt/directconverter && docker-compose up -d'"
puts ""
puts "  æª¢æŸ¥ç‹€æ…‹:"
puts "    ssh root@172.238.14.142 'cd /opt/directconverter && docker-compose ps'"
puts ""
puts "ğŸ”„ æ›´æ–°ä»£ç¢¼:"
puts "  1. æœ¬åœ°ä¿®æ”¹ä»£ç¢¼"
puts "  2. ä¸Šå‚³: rsync -avz --exclude node_modules --exclude __pycache__ ./ root@172.238.14.142:/opt/directconverter/"
puts "  3. é‡å»º: ssh root@172.238.14.142 'cd /opt/directconverter && docker-compose up -d --build'"
puts ""
puts "ğŸ”’ å®‰å…¨æç¤º:"
puts "  â€¢ å»ºè­°ä¿®æ”¹ root å¯†ç¢¼"
puts "  â€¢ å»ºè­°è¨­ç½® SSH å¯†é‘°ç™»å…¥"
puts "  â€¢ å»ºè­°é…ç½®é˜²ç«ç‰†è¦å‰‡"
puts "  â€¢ å¯ä»¥è€ƒæ…®æ·»åŠ åŸŸåå’Œ SSL æ†‘è­‰"
puts "=========================================\n"
